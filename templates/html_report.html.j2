<!DOCTYPE html>
<html>
<head>
    <title>{{ title }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        h1 { color: #333; }
        .metadata { background-color: #f5f5f5; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .section { margin: 20px 0; }
        .source { margin: 10px 0; padding: 10px; border-left: 3px solid #ccc; }
    </style>
</head>
<body>
    <h1>{{ title }}</h1>
    
    <div class="metadata">
        <p><strong>Research Query:</strong> {{ query }}</p>
        <p><strong>Generated on:</strong> {{ timestamp }}</p>
        <p><strong>Confidence Level:</strong> {{ confidence_level }}</p>
    </div>
    
    <div class="section">
        <h2>Summary</h2>
        <p>{{ summary }}</p>
    </div>
    
    <div class="section">
        <h2>Key Findings</h2>
        <ul>
        {% for finding in key_findings %}
            <li>{{ finding }}</li>
        {% endfor %}
        </ul>
    </div>
    
    <div class="section">
        <h2>Analysis</h2>
        <p>{{ analysis }}</p>
    </div>

    {% if knowledge_graph_mermaid %}
    <div class="section">
        <h2>Knowledge Graph</h2>
        <pre>{{ knowledge_graph_mermaid }}</pre>
    </div>
    {% endif %}
    
    {% if sources and include_sources %}
    <div class="section">
        <h2>Sources</h2>
        {% for source in sources %}
        <div class="source">
            <h3><a href="{{ source.url }}" target="_blank">{{ source.title }}</a></h3>
            <p>{{ source.summary[:200] }}...</p>
        </div>
        {% endfor %}
        {% if credibility_matrix %}
        <h3>Source Credibility Matrix</h3>
        <table border="1" cellpadding="6">
            <tr><th>Title</th><th>Domain</th><th>Peer Review</th><th>Timeliness</th><th>Relevance</th></tr>
            {% for row in credibility_matrix %}
            <tr>
                <td>{{ row.title[:20] }}</td>
                <td>{{ row.domain }}</td>
                <td>{{ row.peer_review }}</td>
                <td>{{ row.timeliness }}</td>
                <td>{{ '%.2f'|format(row.relevance) }}</td>
            </tr>
            {% endfor %}
        </table>
        {% endif %}
    </div>
    {% endif %}
    
    {% if contradictions %}
    <div class="section">
        <h2>Contradictions Identified</h2>
        <ul>
        {% for contradiction in contradictions %}
            <li>{{ contradiction }}</li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}
    
    {% if gaps %}
    <div class="section">
        <h2>Information Gaps</h2>
        <ul>
        {% for gap in gaps %}
            <li>{{ gap }}</li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}

    {% if methodology %}
    <div class="section">
        <h2>Methodology</h2>
        <h3>Strategy Steps</h3>
        <ul>
            {% for s in methodology.strategy %}
            <li>{{ s }}</li>
            {% endfor %}
        </ul>
        <h3>Parameter Inference</h3>
        <pre>{{ methodology.inference }}</pre>
        <h3>Iterations</h3>
        <p>{{ methodology.iterations }}</p>
    </div>
    {% endif %}

    {% if evaluation_metrics %}
    <div class="section">
        <h2>Evaluation Metrics</h2>
        <ul>
            <li>Coverage Iterations: {{ evaluation_metrics.coverage_iterations }}</li>
            <li>Source Diversity: {{ evaluation_metrics.source_diversity }}</li>
            <li>Closure: {{ '%.2f'|format(evaluation_metrics.closure) }}</li>
            <li>Quality Warning: {{ evaluation_metrics.quality_warning }}</li>
        </ul>
    </div>
    {% endif %}
    
    <hr>
    <p><em>Generated by Deep Research Report Generation Agent System</em></p>
</body>
</html>
